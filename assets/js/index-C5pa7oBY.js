var w=Object.defineProperty;var M=(s,r,e)=>r in s?w(s,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[r]=e;var o=(s,r,e)=>M(s,typeof r!="symbol"?r+"":r,e);import{a as m}from"./axios-DsPaXkF5.js";import{N as u}from"./nprogress-DCIUucrG.js";import{u as i}from"./element-plus-DK5rwodP.js";import{d as g,o as q,c as y,a as p}from"./@vue-CosTd1Qi.js";import"./dayjs-Cpj98o6Y.js";import"./lodash-es-BSJuvVl3.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DMpeZSDY.js";import"./@element-plus-ByZtADF-.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";const f=(s,r)=>r.reduceRight((t,n)=>()=>n(s,t),()=>Promise.resolve(s))(),c=(s,r)=>r.reduceRight((t,n)=>()=>n(s,t),()=>Promise.reject(s))(),E=(s,r)=>r.reduceRight((t,n)=>h=>n(h||s,t),t=>Promise.resolve(t||s))();class R{constructor(){o(this,"requestMiddlewares",[]);o(this,"responseMiddlewares",[]);o(this,"errorMiddlewares",[])}useRequestMiddleware(r){return Array.isArray(r)?this.requestMiddlewares.push(...r):this.requestMiddlewares.push(r),this}useResponseMiddleware(r){return Array.isArray(r)?this.responseMiddlewares.push(...r):this.responseMiddlewares.push(r),this}useErrorMiddleware(r){return Array.isArray(r)?this.errorMiddlewares.push(...r):this.errorMiddlewares.push(r),this}async runRequestMiddlewares(r){return f(r,this.requestMiddlewares)}async runResponseMiddlewares(r){return E(r,this.responseMiddlewares)}async runErrorMiddlewares(r){return c(r,this.errorMiddlewares)}}class _ extends R{constructor(e){super();o(this,"instance");o(this,"options");o(this,"request",(e,t)=>{const n={...this.options,...t,...e};return this.instance.request(n)});o(this,"get",(e,t={},n={})=>this.request({url:e,params:t,method:"GET"},n));o(this,"post",(e,t={},n={})=>this.request({url:e,data:t,method:"POST"},n));o(this,"put",(e,t={},n={})=>this.request({url:e,data:t,method:"PUT"},n));o(this,"delete",(e,t={},n={})=>this.request({url:e,data:t,method:"DELETE"},n));this.options=e,this.instance=m.create(e),this.setupInterceptors()}setupInterceptors(){this.instance.interceptors.request.use(async e=>await super.runRequestMiddlewares(e),async e=>(await super.runErrorMiddlewares(e),Promise.reject(e))),this.instance.interceptors.response.use(async e=>await super.runResponseMiddlewares(e),async e=>(await super.runErrorMiddlewares(e),Promise.reject(e)))}}class l extends Error{constructor(e,t){super(e);o(this,"response");this.name="BusinessLogicError",this.response=t}}const B=async(s,r)=>{u.start();try{const e=await r();return u.done(),e}catch(e){throw u.done(),console.log("error progress",e),e}},d=async(s,r)=>{var t;return console.log("error.name",s.name),s.name==="BusinessLogicError"?(console.error("捕获到业务逻辑错误:",s.message),i.error(`业务逻辑错误: ${s.message}`)):((t=s.response)==null?void 0:t.status)!==404&&(console.error("捕获到非业务逻辑错误:",s),i.error(`${s.message} ${s.code}`)),await r()},A=async(s,r)=>{console.log("notFound-> Before request:",s),i.error("请求资源不存在");const e=await r();return console.log("notFound-> After request:",e),e},P=async(s,r)=>{console.log("auth-> Before request:",s),s.headers["Content-Type"]="application/json",s.headers.Authorization="Bearer token";const e=await r();return console.log("auth-> After request:",e),e},x=async(s,r)=>{const{data:e,status:t}=s;return t!==200?await c(new l("请求失败",s),[d]):e.code!==2e3?await c(new l(e.message,s),[d]):r(e)},C=()=>{const s=new _({baseURL:"http://123.60.72.205:7777/North/api",timeout:1e4});return s.useRequestMiddleware([B,P]).useResponseMiddleware([x]).useErrorMiddleware([d,A]),s},a=C(),L=a.get;a.post;a.put;a.request;a.delete;const T=s=>L("/weather/now1",s),j=p("h1",null,"Home",-1),k=p("p",null,"Home page content",-1),H=[j,k],V=g({__name:"index",setup(s){return T({location:"116.41,39.92"}).then(r=>{console.log(r.data.feelsLike,"res")}),(r,e)=>(q(),y("div",null,H))}});export{V as default};
